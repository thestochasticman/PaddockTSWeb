# Interpolates DOMAIN from the environment
{$DOMAIN} {
  encode zstd gzip

  # App under /PaddockTS (do NOT strip the prefix; Next is built with basePath=/PaddockTS)
  @app path /PaddockTS*
  handle @app {
    reverse_proxy frontend:3000
  }

  # API under /PaddockTS/api -> backend (strip the prefix)
  handle_path /PaddockTS/api/* {
    reverse_proxy backend:3200
  }

  # Everything else to your existing site
  handle {
    # If the other site is another container:
    # reverse_proxy legacy_web:8080

    # If it runs on the host:
    reverse_proxy 127.0.0.1:8080
  }

  header {
    X-Content-Type-Options "nosniff"
    Referrer-Policy "strict-origin-when-cross-origin"
  }
}